# PRD: Google Sheets ↔ Excel ↔ 이카운트 통합 자동화 시스템

## 1. 프로젝트 개요

### 1.1 목적

Google Sheets ERP 시트의 데이터를 자동으로 이카운트 ERP 시스템으로 전송하는 완전 자동화 솔루션 개발

### 1.2 배경

- 수동 데이터 입력으로 인한 시간 소모 및 오류 발생
- Google Sheets와 이카운트 간 데이터 동기화 필요
- 생산 입고 데이터의 실시간 반영 요구

### 1.3 비즈니스 가치

- 데이터 입력 시간 95% 단축
- 인적 오류 제거
- 실시간 데이터 동기화
- 업무 효율성 극대화

## 2. 시스템 아키텍처

### 2.1 전체 데이터 플로우

```
Google Sheets (ERP 시트)
    ↓ [HTTP API 요청]
Excel VBA 백그라운드 처리
    ↓ [데이터 변환 및 준비]
이카운트 로그인 (5초 화면 노출)
    ↓ [UI 자동화]
생산입고II 시트 업데이트
    ↓ [자동 업로드]
완료 알림 및 종료
```

### 2.2 기술 스택

- **Frontend**: 없음 (완전 백그라운드)
- **Backend**: Excel VBA
- **API**: Google Sheets API
- **External**: 이카운트 ERP 시스템
- **Storage**: 로컬 Excel 파일

## 3. 기능 요구사항

### 3.1 핵심 기능

#### 3.1.1 Google Sheets 데이터 추출

- **소스**: https://docs.google.com/spreadsheets/d/1DJyHnnLDQmiZEnGXr1nIpTZ1orFhDyXUuZEe9hpKAwQ/edit
- **대상 시트**: ERP 시트
- **데이터 범위**: 2행부터 모든 데이터 (헤더 제외)
- **실행 방식**: HTTP GET 요청

#### 3.1.2 Excel 백그라운드 처리

- **실행 모드**: Excel.Application.Visible = False
- **알림 비활성화**: DisplayAlerts = False
- **데이터 변환**: Google Sheets 형식 → 이카운트 형식
- **임시 파일**: 메모리 상에서 처리

#### 3.1.3 이카운트 자동화

- **로그인 자동화**: 저장된 인증정보로 자동 로그인
- **메뉴 네비게이션**: 자료입력하기 → 재고 → 생산입고II
- **시트 생성**: '1\_생산입고II' 시트 자동 생성
- **데이터 입력**: 2행부터 데이터 자동 입력
- **업로드 실행**: '자료 전송하기' 버튼 자동 클릭

### 3.2 실행 트리거 옵션

#### 3.2.1 우선순위 1: Google Sheets 함수 실행

```javascript
// Apps Script 트리거 함수
function triggerVBAExecution() {
  // VBA 실행을 위한 웹훅 호출
  // 또는 이메일/알림 방식
}
```

#### 3.2.2 우선순위 2: 시간 기반 자동 실행

- **실행 시간**: 매일 오후 6시
- **구현**: Windows 작업 스케줄러
- **조건**: Google Sheets 데이터 변경 감지 시에만

#### 3.2.3 우선순위 3: 수동 실행

- **위치**: Excel 메뉴바 (도움말 옆)
- **메뉴명**: "이카운트 동기화"
- **실행**: 원클릭 실행

## 4. 기술 설계

### 4.1 VBA 주요 모듈 구조

#### 4.1.1 메인 컨트롤러

```vba
Sub MainController()
    ' 1. Google Sheets 데이터 가져오기
    ' 2. 데이터 변환 및 검증
    ' 3. 이카운트 로그인
    ' 4. 데이터 업로드
    ' 5. 완료 처리
End Sub
```

#### 4.1.2 Google Sheets 연동 모듈

```vba
Function GetGoogleSheetsData() As Variant
    ' HTTP 요청으로 ERP 시트 데이터 추출
    ' 2행부터 데이터 반환
End Function
```

#### 4.1.3 이카운트 자동화 모듈

```vba
Sub ICountAutomation()
    ' 로그인 → 메뉴 네비게이션 → 데이터 입력 → 업로드
End Sub
```

### 4.2 데이터 매핑

#### 4.2.1 Google Sheets → 이카운트 매핑

```
Google Sheets ERP 시트 컬럼:
A열(일자) → 이카운트 '일자' 필드
B열(품목코드) → 이카운트 '품목코드' 필드
C열(품목명) → 이카운트 '품목명' 필드
... (추가 컬럼 매핑)
```

#### 4.2.2 데이터 변환 규칙

- **날짜 형식**: YYYY-MM-DD → 이카운트 형식
- **숫자 형식**: 천단위 구분자 처리
- **텍스트**: 특수문자 이스케이프 처리

### 4.3 인증 및 보안

#### 4.3.1 이카운트 인증정보 관리

```vba
' 암호화된 인증정보 저장
Private Const ICOUNT_CODE = "암호화된코드"
Private Const ICOUNT_USER = "암호화된사용자ID"
Private Const ICOUNT_PASS = "암호화된비밀번호"
```

#### 4.3.2 Google Sheets API 인증

- **방식**: Service Account 키 파일
- **권한**: 읽기 전용
- **범위**: 특정 스프레드시트만

## 5. 사용자 경험 설계

### 5.1 사용자 인터페이스

- **기본**: 백그라운드 실행 (화면 노출 없음)
- **필요시**: 최소한의 팝업 알림
- **이카운트**: 로그인/업로드 시에만 5-10초 화면 표시

### 5.2 진행상황 표시

```vba
' 작업 단계별 알림
"1/5 Google Sheets 데이터 가져오는 중..."
"2/5 데이터 변환 중..."
"3/5 이카운트 로그인 중..."
"4/5 데이터 업로드 중..."
"5/5 완료! 총 X건 업로드됨"
```

### 5.3 에러 알림

- **성공**: "업로드 완료: X건 처리됨"
- **실패**: "오류 발생: [구체적 오류 메시지]"
- **부분 성공**: "일부 완료: X/Y건 성공"

## 6. 예외 처리

### 6.1 네트워크 관련

- **Google Sheets 접근 실패**: 재시도 3회 후 중단
- **인터넷 연결 끊김**: 연결 복구 대기

### 6.2 인증 관련

- **이카운트 로그인 실패**: 인증정보 확인 요청
- **세션 만료**: 자동 재로그인

### 6.3 데이터 관련

- **빈 데이터**: "업로드할 데이터가 없습니다" 알림
- **형식 오류**: 오류 행 번호와 함께 알림
- **중복 데이터**: 사용자 선택 (덮어쓰기/건너뛰기)

### 6.4 시스템 관련

- **Excel 실행 실패**: 관리자 권한 확인
- **이카운트 프로그램 미실행**: 자동 실행 시도
- **메모리 부족**: 배치 단위로 처리

## 7. 성능 요구사항

### 7.1 처리 속도

- **데이터 추출**: 5초 이내
- **변환 및 검증**: 3초 이내
- **이카운트 업로드**: 행당 0.5초
- **전체 프로세스**: 100건 기준 2분 이내

### 7.2 데이터 용량

- **최대 처리량**: 1000행
- **메모리 사용량**: 50MB 이하
- **임시 파일**: 생성하지 않음

## 8. 배포 및 설치

### 8.1 설치 요구사항

- **OS**: Windows 10/11
- **Excel**: 2016 이상
- **이카운트**: 최신 버전 설치됨
- **권한**: 매크로 실행 허용

### 8.2 설치 과정

1. **VBA 코드 복사**: Excel 파일에 모듈 추가
2. **인증정보 입력**: 이카운트 로그인 정보 암호화 저장
3. **메뉴 등록**: Excel 리본에 "이카운트 동기화" 추가
4. **테스트 실행**: 소량 데이터로 정상 동작 확인

## 9. 테스트 계획

### 9.1 단위 테스트

- [ ] Google Sheets 데이터 추출 정확성
- [ ] 데이터 형식 변환 정확성
- [ ] 이카운트 로그인 성공률
- [ ] UI 자동화 안정성

### 9.2 통합 테스트

- [ ] 전체 프로세스 종단간 테스트
- [ ] 대용량 데이터 처리 테스트
- [ ] 오류 상황 복구 테스트

### 9.3 사용자 수용 테스트

- [ ] 실제 업무 환경에서 테스트
- [ ] 사용자 편의성 확인
- [ ] 성능 만족도 확인

## 10. 유지보수

### 10.1 모니터링

- **실행 로그**: 날짜/시간/처리건수/소요시간
- **오류 로그**: 오류 종류/빈도/해결 방법
- **성능 지표**: 처리 속도/메모리 사용량

### 10.2 업데이트 계획

- **정기 점검**: 월 1회 정상 동작 확인
- **이카운트 업데이트**: UI 변경 시 코드 수정
- **기능 개선**: 사용자 요청사항 반영

## 11. 위험 관리

### 11.1 주요 위험요소

- **이카운트 UI 변경**: 자동화 실패 가능성
- **Google Sheets API 변경**: 데이터 추출 실패
- **네트워크 불안정**: 중간 실행 중단

### 11.2 완화 방안

- **UI 요소 다중 선택자**: 여러 방식으로 요소 찾기
- **API 버전 고정**: 안정 버전 사용
- **재시도 로직**: 실패 시 자동 재실행

## 12. 성공 기준

### 12.1 정량적 지표

- **자동화율**: 95% 이상
- **오류율**: 1% 이하
- **처리 속도**: 기존 대비 10배 이상 향상
- **사용자 만족도**: 4.5/5점 이상

### 12.2 정성적 지표

- **사용 편의성**: 원클릭 실행
- **안정성**: 주 5일 연속 정상 동작
- **투명성**: 처리 과정 실시간 확인 가능

## 13. 추가 고려사항

### 13.1 확장성

- **다른 ERP 시스템**: 모듈화 구조로 쉬운 확장
- **추가 데이터 소스**: Google Sheets 외 다른 소스 연동
- **다중 사용자**: 동시 실행 지원

### 13.2 백업 및 복구

- **데이터 백업**: 업로드 전 로컬 백업
- **롤백 기능**: 업로드 취소 시 이전 상태 복구
- **수동 모드**: 자동화 실패 시 수동 처리 지원

이 PRD를 기반으로 개발을 진행하시면 완전 자동화된 Google Sheets ↔ 이카운트 연동 시스템을 구축할 수 있습니다.
