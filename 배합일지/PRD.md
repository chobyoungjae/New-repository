# PRD: Google Sheets 뷰-ERP 데이터 변환 시스템

## 1. 프로젝트 개요

### 목적

Google Sheets의 "뷰" 시트에 격자 형태로 배열된 8개 테이블 데이터를 "ERP" 시트의 행 단위 형태로 자동 변환하는 Google Apps Script 함수 개발

### 배경

- 현재 뷰 시트에 8개의 테이블이 2x4 격자로 배열되어 있음
- 각 테이블은 헤더 정보와 품목 데이터로 구성
- ERP 시트는 모든 데이터를 행 단위로 저장하는 형태
- 수동 변환 작업을 자동화하여 효율성 증대 필요

## 2. 기능 요구사항

### 2.1 핵심 기능

- 뷰 시트 8개 테이블의 데이터를 ERP 시트로 행 단위 변환
- 메뉴바를 통한 원클릭 실행
- 기존 ERP 데이터 삭제 후 새 데이터 입력

### 2.2 데이터 매핑 규칙

#### 테이블 위치 (8개)

1. A12:E37 (1번째)
2. G12:K37 (2번째)
3. M12:Q37 (3번째)
4. S12:W37 (4번째)
5. A39:E64 (5번째)
6. G39:K64 (6번째)
7. M39:Q64 (7번째)
8. S39:W64 (8번째)

#### 각 테이블 내 매핑 (절대 좌표 기준 - 1번 테이블 예시)

뷰 시트 → ERP 시트
C14 (타임스탬프) → A열 (데이터 행 수만큼 반복)
고정값 "미쓰리" → D열 (모든 행)
고정값 "불출창고" → E열 (모든 행)
C15 (코드) → I열 (데이터 행 수만큼 반복)
C16 (세부정보) → J열 (데이터 행 수만큼 반복)
C19 (총액) → M열 (데이터 행 수만큼 반복)
B22~B36 (품목코드) → Q열 (실제 데이터만)
C22~C36 (품목명) → R열 (실제 데이터만)
D22~D36 (수량) → T열 (실제 데이터만)
E22~E36 (단가) → W열 (실제 데이터만)

### 2.3 처리 로직

1. **데이터 존재 확인**: 각 테이블의 품목코드 열(B+10~B+24)에서 실제 데이터가 있는 행 수 계산
2. **헤더 정보 반복**: 타임스탬프, 코드, 세부정보, 총액을 데이터 행 수만큼 반복 입력
3. **품목 데이터 복사**: 실제 데이터가 있는 행만 순차적으로 복사
4. **연속 배치**: 이전 테이블 마지막 행 다음부터 새 테이블 데이터 시작
5. **타임스탬프 변환**: 날짜를 "YYYYMMDD" 형식으로 변환

## 3. 기술 요구사항

### 3.1 개발 환경

- **플랫폼**: Google Apps Script
- **언어**: JavaScript
- **대상**: Google Sheets

### 3.2 실행 방법

- 기존 메뉴바 "생산뷰" → "타임스템프 이동" 클릭으로 실행
- 기존 Apps Script 프로젝트에 함수 추가

### 3.3 성능 요구사항

- 8개 테이블 × 최대 15행 = 120개 데이터 행 처리 가능
- 실행 시간 30초 이내
- 메모리 효율적 배치 읽기/쓰기 구현

## 4. 예외 처리

### 4.1 데이터 검증

- 빈 테이블 건너뛰기
- 타임스탬프 변환 실패 시 원본 값 유지
- 잘못된 데이터 형식에 대한 로그 출력

### 4.2 에러 핸들링

- 시트 접근 실패 시 사용자 알림
- 권한 부족 시 안내 메시지
- 처리 중 중단 시 롤백 기능

## 5. 사용자 시나리오

### 5.1 기본 사용 시나리오

1. 사용자가 뷰 시트에 데이터 입력 완료
2. 메뉴바에서 "생산뷰" → "타임스템프 이동" 클릭
3. 시스템이 8개 테이블을 순차적으로 처리
4. ERP 시트에 행 단위로 변환된 데이터 저장 완료
5. 완료 메시지 표시

### 5.2 데이터 예시

1번 테이블에 4개 품목, 2번 테이블에 3개 품목이 있는 경우:
ERP 시트 결과:
A2:A5 = 1번 테이블 타임스탬프 (4번 반복)
I2:I5 = 1번 테이블 코드 (4번 반복)
J2:J5 = 1번 테이블 세부정보 (4번 반복)
M2:M5 = 1번 테이블 총액 (4번 반복)
Q2:Q5 = 1번 테이블 품목코드 4개
R2:R5 = 1번 테이블 품목명 4개
T2:T5 = 1번 테이블 수량 4개
W2:W5 = 1번 테이블 단가 4개
A6:A8 = 2번 테이블 타임스탬프 (3번 반복)
I6:I8 = 2번 테이블 코드 (3번 반복)
...

## 6. 추가 고려사항

### 6.1 확장성

- 테이블 수 변경 시 쉬운 수정 가능한 구조
- 매핑 규칙 변경 시 최소한의 코드 수정

### 6.2 유지보수

- 명확한 변수명과 주석 사용
- 함수 단위로 모듈화
- 디버깅을 위한 로그 기능

### 6.3 사용자 경험

- 처리 진행상황 표시
- 명확한 완료/에러 메시지
- 실행 취소 불가 시 사전 경고

## 7. 검증 기준

- [ ] 8개 모든 테이블에서 데이터 정확히 추출
- [ ] ERP 시트에 올바른 순서로 데이터 배치
- [ ] 헤더 정보가 데이터 행 수만큼 정확히 반복
- [ ] 타임스탬프가 올바른 형식으로 변환
- [ ] 빈 테이블 건너뛰기 정상 동작
- [ ] 메뉴 클릭으로 정상 실행
- [ ] 에러 발생 시 적절한 메시지 표시

## 8. 개발 범위

**포함사항:**

- 데이터 변환 메인 함수
- 메뉴 등록 함수
- 에러 처리 로직
- 사용자 알림 기능

**제외사항:**

- 데이터 유효성 검증 (기본적인 것만)
- 실행 기록 저장
- 다른 시트 연동
